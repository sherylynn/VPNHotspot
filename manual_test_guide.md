# VPNHotspot 自动连接设置测试指南

## 测试目标
验证在设置页面添加的"远程控制自动连接"开关功能是否正常工作。

## 测试环境
- 设备：192.168.1.133:5555
- 应用：VPNHotspot
- 功能：远程控制自动连接开关

## 功能说明
- **开关位置**：设置页面 → 远程控制自动连接
- **功能描述**：进入远程控制页面时是否自动尝试连接上次保存的远程设备
- **默认值**：开启（true）

## 测试步骤

### 1. 基本功能测试

#### 1.1 开关状态验证
```bash
# 连接设备
adb connect 192.168.1.133:5555

# 检查设置值
adb shell "cat /data/data/be.mygod.vpnhotspot/shared_prefs/be.mygod.vpnhotspot_preferences.xml | grep remote.control.auto.connect"
```

#### 1.2 开关切换测试
1. 打开应用 → 设置 → 找到"远程控制自动连接"开关
2. 记录当前状态（默认为开启）
3. 切换开关状态
4. 重新进入设置页面，验证状态是否保持

### 2. 自动连接行为测试

#### 2.1 开启状态下的行为
1. 确保"远程控制自动连接"开关为开启状态
2. 进入远程控制页面
3. **预期行为**：自动尝试连接上次保存的远程设备
4. 观察是否有自动连接提示或状态显示

#### 2.2 关闭状态下的行为
1. 将"远程控制自动连接"开关设置为关闭状态
2. 进入远程控制页面
3. **预期行为**：不会自动连接，需要手动点击"连接远程设备"按钮

### 3. 设置持久化测试

#### 3.1 重启应用后设置保持
1. 设置开关状态为关闭
2. 完全关闭应用（从最近任务中移除）
3. 重新打开应用
4. 进入设置页面，验证开关状态仍为关闭

#### 3.2 重启设备后设置保持
1. 设置开关状态为开启
2. 重启设备
3. 打开应用，验证开关状态仍为开启

### 4. 远程连接测试

#### 4.1 连接远程设备
1. 在远程控制页面输入远程设备信息：
   - IP地址：192.168.1.133
   - 端口：9999
   - API Key：从远程设备获取
2. 点击"连接远程设备"
3. 验证连接成功

#### 4.2 自动连接验证
1. 成功连接后，连接信息会被保存
2. 退出远程控制页面
3. 重新进入远程控制页面
4. 根据开关状态验证是否自动连接：
   - 开关开启：自动连接
   - 开关关闭：需手动连接

## 验证点

### 代码验证
- [x] 设置页面已添加"远程控制自动连接"开关
- [x] RemoteControlFragment.kt已读取全局设置
- [x] 设置状态持久化到SharedPreferences
- [x] 开关状态影响自动连接行为

### 功能验证
- [ ] 开关UI显示正常
- [ ] 开关状态可切换
- [ ] 设置值正确保存
- [ ] 远程控制页面根据设置正确行为
- [ ] 重启应用后设置保持

## 问题排查

### 常见问题
1. **开关不显示**：检查pref_settings.xml中是否正确添加了SwitchPreferenceCompat
2. **设置不生效**：检查SharedPreferences键名是否匹配
3. **自动连接失败**：检查网络连接和API Key是否正确

### 调试命令
```bash
# 查看SharedPreferences内容
adb shell "cat /data/data/be.mygod.vpnhotspot/shared_prefs/be.mygod.vpnhotspot_preferences.xml"

# 查看远程控制专用SharedPreferences
adb shell "cat /data/data/be.mygod.vpnhotspot/shared_prefs/remote_control_prefs.xml"

# 查看日志
adb shell "logcat -d | grep RemoteControl"
```

## 测试完成标准
- [ ] 所有测试步骤执行完毕
- [ ] 功能符合预期
- [ ] 无明显bug
- [ ] 用户体验良好