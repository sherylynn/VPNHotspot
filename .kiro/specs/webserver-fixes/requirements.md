# 需求文档

## 介绍

此功能解决VPN热点应用程序网页服务器功能中的两个关键问题：
1. 剪贴板复制功能在没有用户交互的情况下被自动触发
2. 网页管理后台在应用运行一段时间后变得无法访问，即使重启应用也不行

## 需求

### 需求1：修复自动剪贴板复制问题

**用户故事：** 作为用户，我希望剪贴板复制功能只在我手动点击"复制后台地址"选项时执行，这样我的剪贴板就不会在未经我同意的情况下被修改。

#### 验收标准

1. 当用户打开API Key管理对话框时，系统不应自动修改剪贴板
2. 当用户选择"复制后台地址"选项时，系统应将网页后台URL复制到剪贴板且仅复制一次
3. 当剪贴板复制操作完成时，系统应显示确认操作的提示消息
4. 如果无法获取设备IP地址，系统应回退到仅复制API Key

### 需求2：修复网页后台可访问性问题

**用户故事：** 作为用户，我希望网页管理后台在应用的整个生命周期内以及应用重启后都能保持可访问，这样我就能持续远程管理我的热点。

#### 验收标准

1. 当MainActivity创建时，WebServer应在配置的端口上成功启动
2. 当MainActivity销毁时，WebServer应被正确停止以释放资源
3. 当应用重启时，WebServer应在干净的端口上启动，不会有冲突
4. 当WebServer遇到端口绑定错误时，系统应尝试使用备用端口
5. 当WebServer运行时，它应保持可访问直到被明确停止
6. 如果WebServer启动失败，系统应记录错误并提供用户反馈

### 需求3：改进WebServer生命周期管理

**用户故事：** 作为开发者，我希望WebServer组件有适当的生命周期管理，这样资源就能被正确分配和释放。

#### 验收标准

1. 当Application类创建时，WebServerManager应被初始化
2. 当MainActivity销毁时，WebServerManager应停止当前服务器实例
3. 当应用进程终止时，所有WebServer资源应被正确清理
4. 当WebServer停止时，所有相关的套接字和线程应被关闭
5. 当重启WebServer时，旧实例应在启动新实例之前完全停止